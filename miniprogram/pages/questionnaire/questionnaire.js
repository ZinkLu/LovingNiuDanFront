"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var configs_1 = require("../../configs/configs");
var questionnaireModel_1 = require("./questionnaireModel");
var user_1 = require("./user");
var _today = new Date();
var today_string = _today.getFullYear() + "-" + (_today.getMonth() + 1) + "-" + _today.getDate();
var ChoiceMapping = {
    "Constellation": user_1.Constellation,
    "Education": user_1.Education,
    "Marriage": user_1.Marriage,
    "Gender": user_1.Gender,
};
Page({
    data: {
        userInfo: new questionnaireModel_1.UserInfo(),
        submitted: false,
        today: today_string,
        ConstellationChoice: user_1.Constellation,
        EduChoice: user_1.Education,
        MarriageChoice: user_1.Marriage,
        GenderChoice: user_1.Gender
    },
    onLoad: function (query) {
        console.log(this.data.userInfo.birthDay);
        this.setData({ nickName: query.nickName });
    },
    bindDateChange: function (e) {
        var tmp = this.data.userInfo;
        tmp.birthDay = e.detail.value;
        this.setData({ userInfo: tmp });
    },
    bindSelectorChange: function (e) {
        for (var key in ChoiceMapping) {
            if (Object.prototype.hasOwnProperty.call(ChoiceMapping, key)) {
                var element = ChoiceMapping[key];
                if (e.currentTarget.id.includes(key)) {
                    var choice = element[e.detail.value];
                    var tmp = this.data.userInfo;
                    tmp[key.toLowerCase()] = choice.key;
                    this.setData({ userInfo: tmp });
                }
            }
        }
    },
    submitTable: function (e) {
        var _this = this;
        var payload = JSON.parse(JSON.stringify(this.data.userInfo));
        wx.login({
            success: function (res) {
                wx.request({
                    url: configs_1.config.BASE_URL + "/code",
                    data: { code: res.code },
                    method: "GET",
                    success: function (result) {
                        console.log(result);
                        payload.code = res.code;
                        console.info(payload);
                        wx.request({
                            url: configs_1.config.BASE_URL + "/questionnaire",
                            data: payload,
                            dataType: "json",
                            method: "POST",
                            success: function (req) {
                                _this.makeOrder(res.code, req.data.data.id);
                            },
                            fail: function (req) { console.log(req.errMsg); }
                        });
                    },
                    fail: function () {
                        return;
                    }
                });
            }
        });
    },
    makeOrder: function (code, questionnaire_id) {
        wx.request({
            url: configs_1.config.BASE_URL + "/order",
            data: { code: code, questionnaire_id: questionnaire_id },
            method: "POST",
            success: function (res) {
                console.log("making order now");
                console.log(res);
            }
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlc3Rpb25uYWlyZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInF1ZXN0aW9ubmFpcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxpREFBOEM7QUFDOUMsMkRBQStDO0FBQy9DLCtCQUFtRTtBQUVuRSxJQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFBO0FBQ3ZCLElBQUksWUFBWSxHQUFNLE1BQU0sQ0FBQyxXQUFXLEVBQUUsVUFBSSxNQUFNLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxVQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUksQ0FBQTtBQUV6RixJQUFNLGFBQWEsR0FBRztJQUNwQixlQUFlLEVBQUUsb0JBQWE7SUFDOUIsV0FBVyxFQUFFLGdCQUFTO0lBQ3RCLFVBQVUsRUFBRSxlQUFRO0lBQ3BCLFFBQVEsRUFBRSxhQUFNO0NBQ2pCLENBQUE7QUFFRCxJQUFJLENBQ0Y7SUFDRSxJQUFJLEVBQUU7UUFFSixRQUFRLEVBQUUsSUFBSSw2QkFBUSxFQUFFO1FBR3hCLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLEtBQUssRUFBRSxZQUFZO1FBRW5CLG1CQUFtQixFQUFFLG9CQUFhO1FBQ2xDLFNBQVMsRUFBRSxnQkFBUztRQUNwQixjQUFjLEVBQUUsZUFBUTtRQUN4QixZQUFZLEVBQUUsYUFBTTtLQUNyQjtJQUNELE1BQU0sRUFBTixVQUFPLEtBQTZCO1FBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDeEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQTtJQUM1QyxDQUFDO0lBRUQsY0FBYyxFQUFkLFVBQWUsQ0FBTTtRQUNuQixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQTtRQUM1QixHQUFHLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FB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LE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtnQkFDL0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUNsQixDQUFDO1NBRUYsQ0FDRixDQUFBO0lBQ0gsQ0FBQztDQVdGLENBQ0YsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSBcIi4uLy4uL2NvbmZpZ3MvY29uZmlnc1wiXG5pbXBvcnQgeyBVc2VySW5mbyB9IGZyb20gXCIuL3F1ZXN0aW9ubmFpcmVNb2RlbFwiXG5pbXBvcnQgeyBDb25zdGVsbGF0aW9uLCBFZHVjYXRpb24sIE1hcnJpYWdlLCBHZW5kZXIgfSBmcm9tIFwiLi91c2VyXCJcblxubGV0IF90b2RheSA9IG5ldyBEYXRlKClcbmxldCB0b2RheV9zdHJpbmcgPSBgJHtfdG9kYXkuZ2V0RnVsbFllYXIoKX0tJHtfdG9kYXkuZ2V0TW9udGgoKSArIDF9LSR7X3RvZGF5LmdldERhdGUoKX1gXG5cbmNvbnN0IENob2ljZU1hcHBpbmcgPSB7XG4gIFwiQ29uc3RlbGxhdGlvblwiOiBDb25zdGVsbGF0aW9uLFxuICBcIkVkdWNhdGlvblwiOiBFZHVjYXRpb24sXG4gIFwiTWFycmlhZ2VcIjogTWFycmlhZ2UsXG4gIFwiR2VuZGVyXCI6IEdlbmRlcixcbn1cblxuUGFnZShcbiAge1xuICAgIGRhdGE6IHtcblxuICAgICAgdXNlckluZm86IG5ldyBVc2VySW5mbygpLFxuXG4gICAgICAvLyBjb250cm9sXG4gICAgICBzdWJtaXR0ZWQ6IGZhbHNlLFxuICAgICAgdG9kYXk6IHRvZGF5X3N0cmluZyxcblxuICAgICAgQ29uc3RlbGxhdGlvbkNob2ljZTogQ29uc3RlbGxhdGlvbixcbiAgICAgIEVkdUNob2ljZTogRWR1Y2F0aW9uLFxuICAgICAgTWFycmlhZ2VDaG9pY2U6IE1hcnJpYWdlLFxuICAgICAgR2VuZGVyQ2hvaWNlOiBHZW5kZXJcbiAgICB9LFxuICAgIG9uTG9hZChxdWVyeTogUmVjb3JkPHN0cmluZywgc3RyaW5nPikge1xuICAgICAgY29uc29sZS5sb2codGhpcy5kYXRhLnVzZXJJbmZvLmJpcnRoRGF5KVxuICAgICAgdGhpcy5zZXREYXRhKHsgbmlja05hbWU6IHF1ZXJ5Lm5pY2tOYW1lIH0pXG4gICAgfSxcblxuICAgIGJpbmREYXRlQ2hhbmdlKGU6IGFueSkge1xuICAgICAgbGV0IHRtcCA9IHRoaXMuZGF0YS51c2VySW5mb1xuICAgICAgdG1wLmJpcnRoRGF5ID0gZS5kZXRhaWwudmFsdWVcbiAgICAgIHRoaXMuc2V0RGF0YSh7IHVzZXJJbmZvOiB0bXAgfSlcbiAgICB9LFxuXG4gICAgYmluZFNlbGVjdG9yQ2hhbmdlKGU6IGFueSkge1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gQ2hvaWNlTWFwcGluZykge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKENob2ljZU1hcHBpbmcsIGtleSkpIHtcbiAgICAgICAgICBjb25zdCBlbGVtZW50ID0gQ2hvaWNlTWFwcGluZ1trZXldXG5cbiAgICAgICAgICBpZiAoZS5jdXJyZW50VGFyZ2V0LmlkLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGNob2ljZSA9IGVsZW1lbnRbZS5kZXRhaWwudmFsdWVdXG4gICAgICAgICAgICBsZXQgdG1wID0gdGhpcy5kYXRhLnVzZXJJbmZvXG4gICAgICAgICAgICB0bXBba2V5LnRvTG93ZXJDYXNlKCldID0gY2hvaWNlLmtleVxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHsgdXNlckluZm86IHRtcCB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBzdWJtaXRUYWJsZShlOiBhbnkpIHtcbiAgICAgIC8vIOmqjOivgVxuICAgICAgLy8gY29uc29sZS5pbmZvKGUpXG4gICAgICAvLyBpZiAoIWNoZWNrSW5wdXRzKHRoaXMuZGF0YS51c2VySW5mbykpIHtcbiAgICAgIC8vIH1cblxuICAgICAgdmFyIHBheWxvYWQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuZGF0YS51c2VySW5mbykpXG5cbiAgICAgIHd4LmxvZ2luKHtcbiAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgICAgICAgdXJsOiBjb25maWcuQkFTRV9VUkwgKyBcIi9jb2RlXCIsXG4gICAgICAgICAgICBkYXRhOiB7IGNvZGU6IHJlcy5jb2RlIH0sXG4gICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdClcbiAgICAgICAgICAgICAgcGF5bG9hZC5jb2RlID0gcmVzLmNvZGVcbiAgICAgICAgICAgICAgLy8g5Y+R6YCB6K+35rGCXG5cbiAgICAgICAgICAgICAgY29uc29sZS5pbmZvKHBheWxvYWQpXG4gICAgICAgICAgICAgIHd4LnJlcXVlc3QoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdXJsOiBjb25maWcuQkFTRV9VUkwgKyBcIi9xdWVzdGlvbm5haXJlXCIsXG4gICAgICAgICAgICAgICAgICBkYXRhOiBwYXlsb2FkLFxuICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVxKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1ha2VPcmRlcihyZXMuY29kZSwgcmVxLmRhdGEuZGF0YS5pZClcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBmYWlsOiAocmVxKSA9PiB7IGNvbnNvbGUubG9nKHJlcS5lcnJNc2cpIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsOiAoKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcblxuICAgIG1ha2VPcmRlcihjb2RlOiBzdHJpbmcsIHF1ZXN0aW9ubmFpcmVfaWQ6IG51bWJlcikge1xuXG4gICAgICAvLyBjb25zb2xlLmxvZyhjb2RlLCBxdWVzdGlvbm5haXJlX2lkKVxuXG4gICAgICB3eC5yZXF1ZXN0KFxuICAgICAgICB7XG4gICAgICAgICAgdXJsOiBjb25maWcuQkFTRV9VUkwgKyBcIi9vcmRlclwiLFxuICAgICAgICAgIGRhdGE6IHsgY29kZTogY29kZSwgcXVlc3Rpb25uYWlyZV9pZDogcXVlc3Rpb25uYWlyZV9pZCB9LFxuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJtYWtpbmcgb3JkZXIgbm93XCIpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFBheSgpXG4gICAgICAgIH1cbiAgICAgIClcbiAgICB9LFxuXG4gICAgLy8gUGF5KCkge1xuXG4gICAgLy8gICB3eC5yZXF1ZXN0UGF5bWVudChcbiAgICAvLyAgICAge1xuXG4gICAgLy8gICAgIH1cbiAgICAvLyAgIClcblxuICAgIC8vIH1cbiAgfVxuKVxuXG4iXX0=